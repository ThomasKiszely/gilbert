<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Password reset</title>
    <link rel="stylesheet" href="/css/style.css">
    <style> .reset-box {
        max-width: 400px;
        margin: 80px auto;
        padding: 30px;
        background: #fff;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
    }
    button {
        margin-top: 15px;
        padding: 10px 20px;
    }
    .success {
        color: green;
    }
    .error {
        color: red;
    }
    </style>
</head>
<body>
<div class="reset-box">
    <h2>Password reset</h2>
    <p id="status">Enter your new password</p>
    <input type="password" id="resetPassword" placeholder="New password" required>
    <input type="password" id="confirmPassword" placeholder="Confirm password" required>

    <button id="resetBtn">Reset Password</button>
</div>

<script>
    const statusEl = document.getElementById('status');
    const resetBtn = document.getElementById('resetBtn');

    async function resetPassword() {
            const params = new URLSearchParams(window.location.search);
            const token  = params.get('token');

            if(!token){
                statusEl.textContent = "Missing reset token";
                statusEl.className = "error";
                return;
            }
            const password = document.getElementById('resetPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if(password != confirmPassword){
                statusEl.textContent = "Passwords do not match";
                statusEl.className = "error";
                return;
            }
            try{
                const res = await fetch("/api/auth/reset-password", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token, newPassword: password}),
                });
                const data = await res.json();
                if(data.success){
                    statusEl.textContent = "Password reset successfully";
                    statusEl.className = "success";
                    setTimeout(()=>{
                        window.location.href="/login";
                    }, 3000);
                } else {
                    statusEl.textContent = data.error || "Password reset failed";
                    statusEl.className = "error";
                }
            } catch(err){
                statusEl.textContent = "Server error";
                statusEl.className = "error";
            }

    }
    resetBtn.addEventListener('click', resetPassword);
</script>
</body>
</html>